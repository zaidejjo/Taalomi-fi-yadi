{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}تسجيل الدخول - تعلمي في يدي{% endblock %}

{% block content %}
<div class="container py-5" dir="rtl" lang="ar">
    <div class="row justify-content-center">
        <div class="col-xl-5 col-lg-6 col-md-8 col-sm-10">
            <div id="login-card" class="card shadow-lg rounded-4 overflow-hidden"
                 style="box-shadow: 0 20px 60px rgba(0,123,255,0.5); opacity: 0; transform: translateY(30px);">

                <!-- Header -->
                <div class="card-header text-center p-4" style="background: linear-gradient(135deg, #007bff, #00b4d8); color: #fff;">
                    <img src="{% static 'images/for_tabe-removebg.png' %}" alt="شعار الموقع" width="70"
                         class="mb-2" style="opacity: 0; transform: scale(0.5);"/>
                    <h3 class="fw-bold mb-0" style="opacity: 0; transform: translateY(-20px);">تسجيل الدخول</h3>
                    <p class="small mt-1 opacity-75" style="opacity: 0; transform: translateY(-20px);">أدخل بياناتك للبدء</p>
                </div>

                <!-- Body -->
                <div class="card-body p-4">
                    {% if form.errors %}
                    <div class="alert alert-danger rounded-3 shadow-sm" id="error-msg">
                        ⚠️ تأكد من صحة الرقم الوطني وكلمة المرور.
                    </div>
                    {% endif %}

                    <form method="post" id="login-form" class="mt-3">
                        {% csrf_token %}

                        <!-- الرقم الوطني -->
                        <div class="mb-3 login-field" style="opacity:0; transform: translateX(-20px);">
                            <label for="id_username" class="form-label fw-semibold">الرقم الوطني</label>
                            {{ form.username|add_class:"form-control form-control-lg shadow-sm rounded-3" }}
                        </div>

                        <!-- كلمة المرور -->
                        <div class="mb-3 login-field" style="opacity:0; transform: translateX(-20px);">
                            <label for="id_password" class="form-label fw-semibold">كلمة المرور</label>
                            {{ form.password|add_class:"form-control form-control-lg shadow-sm rounded-3" }}
                        </div>

                        <button type="submit" class="btn btn-primary w-100 btn-lg rounded-pill shadow-lg mt-3" id="login-btn">
                            تسجيل الدخول
                        </button>
                    </form>

                    <div class="mt-4 text-center small">
                        <a href="{% url 'signup' %}" class="text-decoration-none me-2">تسجيل جديد</a> |
                        <a href="{% url 'password_reset' %}" class="text-decoration-none ms-2">نسيت كلمة المرور؟</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Animate.css CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
    /* Inputs focus effect */
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 15px rgba(0,123,255,0.6);
        transition: all 0.3s ease-in-out;
    }

    /* Button hover + glow + press effect */
    #login-btn {
        transition: all 0.3s ease-in-out;
    }
    #login-btn:hover {
        box-shadow: 0 0 25px rgba(0,123,255,0.8), 0 6px 20px rgba(0,123,255,0.5);
        transform: translateY(-2px) scale(1.02);
    }
    #login-btn:active {
        transform: scale(0.97);
        box-shadow: 0 0 25px rgba(0,123,255,0.9) inset;
    }

    /* Card hover shadow */
    .card {
        transition: all 0.4s ease-in-out;
    }
    .card:hover {
        box-shadow: 0 25px 70px rgba(0,123,255,0.5);
        transform: translateY(-3px);
    }

    /* Error shake */
    .shake {
        animation: shake 0.5s;
    }
    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        50% { transform: translateX(5px); }
        75% { transform: translateX(-5px); }
        100% { transform: translateX(0); }
    }

    /* Dark mode */
    [data-theme="dark"] .card {
        background-color: #2c2c3a !important;
        color: #f5f5f5;
    }
    [data-theme="dark"] .form-control {
        background-color: #3a3a4f; color: #f5f5f5; border-color: #555;
    }
    [data-theme="dark"] .form-control:focus {
        border-color: #00b4d8;
        box-shadow: 0 0 15px rgba(0,180,216,0.6);
    }

    @media (max-width: 576px) {
        .card { margin-top: 2rem !important; }
        .card-header img { width: 50px; }
    }
</style>

<script>
    // Fade + Slide animation for card and fields
    document.addEventListener("DOMContentLoaded", () => {
        const card = document.getElementById('login-card');
        const img = card.querySelector('img');
        const title = card.querySelector('h3');
        const subtitle = card.querySelector('p');
        const fields = document.querySelectorAll('.login-field');

        // Animate card
        setTimeout(() => { card.style.opacity = 1; card.style.transform = 'translateY(0)'; }, 100);

        // Animate header elements
        setTimeout(() => { img.style.opacity=1; img.style.transform='scale(1)'; }, 400);
        setTimeout(() => { title.style.opacity=1; title.style.transform='translateY(0)'; }, 600);
        setTimeout(() => { subtitle.style.opacity=1; subtitle.style.transform='translateY(0)'; }, 800);

        // Animate fields one by one
        fields.forEach((field, index) => {
            setTimeout(() => {
                field.style.opacity = 1;
                field.style.transform = 'translateX(0)';
            }, 1000 + index * 300);
        });
    });

    // Shake effect on error
    const form = document.getElementById('login-form');
    const error = document.getElementById('error-msg');
    if (error) {
        error.classList.add('shake');
    }
</script>
{% endblock %}
